#!/bin/bash

root_dir=$(cd $(dirname $BASH_SOURCE)/.. && pwd)
source $root_dir/bin/common
common::initialize

set -e

usage () {
    echo -e "\n${BLUE}USAGE: caps-info\n"
    echo -e "    This utility will display useful information about the current environment.\n"
}

while [[ $# -gt 0 ]]; do
    case "$1" in
        -v|--debug)
            set -x
            ;;
        *)
            usage
            exit 1
            ;;
    esac
    shift
done

workspace_path=$root_dir/.workspace/$TF_VAR_vpc_name
if [[ ! -e $workspace_path/terraform.output ]]; then
    echo -e "\nERROR! The deployment recipe needs to initialized and refreshed via"
    echo -e "       'caps-tf apply' to retrieve the SSH keys for the bastion"
    echo -e "       instance.\n"
    exit 1
fi

tf_output=$(cat $workspace_path/terraform.output)

# ANSI escape sequence to show colored text

echo -e "\n${LIGHT_GREEN}***********************"
echo -e "${LIGHT_GREEN}* Environment Details *"
echo -e "${LIGHT_GREEN}***********************\n"

echo -e "${LIGHT_BLUE}Name: $name"
echo -e "${LIGHT_BLUE}Type: $deployment_name"
echo -e "${LIGHT_BLUE}IaaS: $iaas_provider${NC}\n"

deployment_info_path=$root_dir/deployments/$deployment_name/show_info
[[ -e $deployment_info_path ]] && source $root_dir/deployments/$deployment_name/show_info
